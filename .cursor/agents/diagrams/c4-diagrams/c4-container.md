# C4 Container Diagram (Level 2)

## Purpose

Shows the applications, databases, and external systems that compose the software system.

## Prerequisites

**Required Input from Discovery:**

```yaml
# From c4-discovery.md Phase 2, 4, and 6
stack:
  backend:
    language: "{language}"
    framework: "{framework}"
    orm: "{orm}"
    database: "{database}"
  frontend:
    language: "{language}"
    framework: "{framework}"
    build_tool: "{build_tool}"

infrastructure:
  external_services:
    - name: "{service_name}"
      type: "{service_type}"

diagram_strategy:
  containers:
    - name: "{container_name}"
      technology: "{tech_stack}"
      type: "{container_type}"
```

---

## Generation Process

### Step 1: Map Containers from Discovery

For each entry in `diagram_strategy.containers`:

| Container Type | PlantUML Element |
|----------------|------------------|
| `web` | `Container(id, "Name", "Technology", "Description")` |
| `api` | `Container(id, "Name", "Technology", "Description")` |
| `database` | `ContainerDb(id, "Name", "Technology", "Description")` |
| `queue` | `ContainerQueue(id, "Name", "Technology", "Description")` |
| `storage` | `Container(id, "Name", "Technology", "Description")` |

### Step 2: Build Technology Strings

Combine discovered technologies:

| Discovery Field | Technology String |
|-----------------|-------------------|
| `stack.frontend.framework` + `stack.frontend.build_tool` | "React, Vite" |
| `stack.backend.framework` + `stack.backend.language` | "NestJS, TypeScript" |
| `stack.backend.database` | "PostgreSQL v17" |

### Step 3: Generate Relationships

Based on architecture:

| Relationship | Protocol |
|--------------|----------|
| Frontend → Backend | "HTTPS/REST" or "HTTPS/GraphQL" |
| Backend → Database | "SQL/{orm}" or "NoSQL" |
| Backend → Cache | "Redis Protocol" |
| Backend → Queue | "AMQP" |
| Backend → Storage | "S3 API" or "File System" |

---

## Elements Reference

### Container (Applications)

```plantuml
Container(id, "Name", "Technology", "Description")
```

### ContainerDb (Databases)

```plantuml
ContainerDb(id, "Name", "Technology", "Description")
```

### System_Boundary (Grouping)

```plantuml
System_Boundary(id, "Name") {
    ' Containers here
}
```

---

## PlantUML Template

```plantuml
@startuml 02-containers
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

' Generated by C4 Diagram Generator on {YYYY-MM-DD}
' Agent: C4 Diagram Generator
' System: {system_name} v{version}

title {system_name} - Container Diagram

' Users (from discovery.diagram_strategy.context.users)
Person({user_id}, "{user_name}", "{user_description}")

' System Boundary
System_Boundary({system_id}, "{system_name}") {
    ' GENERATE CONTAINERS FROM discovery.diagram_strategy.containers
    
    ' Frontend Container (if discovered)
    ' Technology: {stack.frontend.framework}, {stack.frontend.build_tool}
    Container({frontend_id}, "{frontend_name}", "{frontend_tech}", "{frontend_description}")
    
    ' Backend Container (if discovered)
    ' Technology: {stack.backend.framework}, {stack.backend.language}
    Container({backend_id}, "{backend_name}", "{backend_tech}", "{backend_description}")
    
    ' Database Container (from stack.backend.database)
    ContainerDb({db_id}, "{db_name}", "{db_tech}", "{db_description}")
    
    ' Additional containers (storage, cache, queue) if discovered
}

' External Systems (from discovery.infrastructure.external_services)
System_Ext({ext_id}, "{ext_name}", "{ext_description}")

' Relationships
' GENERATE BASED ON DISCOVERED ARCHITECTURE
Rel({user_id}, {frontend_id}, "Uses", "HTTPS")
Rel({frontend_id}, {backend_id}, "Makes requests", "HTTPS/REST")
Rel({backend_id}, {db_id}, "Reads and writes", "{protocol}/{orm}")
Rel({backend_id}, {ext_id}, "Calls", "API")

@enduml
```

---

## Output File

`docs/diagrams/c4/02-containers.puml`

---

## Stack-Specific Examples

### Node.js/TypeScript Stack

```plantuml
Container(frontend, "Frontend Web App", "React, Vite, Tailwind CSS", "SPA interface")
Container(backend, "Backend API", "NestJS, TypeScript, Express", "REST API")
ContainerDb(database, "PostgreSQL Database", "PostgreSQL v17", "Stores data")
```

### Python Stack

```plantuml
Container(frontend, "Frontend Web App", "Vue.js, Vite", "SPA interface")
Container(backend, "Backend API", "FastAPI, Python 3.11", "REST API")
ContainerDb(database, "PostgreSQL Database", "PostgreSQL, SQLAlchemy", "Stores data")
```

### Java Stack

```plantuml
Container(frontend, "Frontend Web App", "Angular, TypeScript", "SPA interface")
Container(backend, "Backend API", "Spring Boot, Java 21", "REST API")
ContainerDb(database, "MySQL Database", "MySQL 8, Hibernate", "Stores data")
```

---

## Validation

Delegate to `@c4-validation.md`:

- [ ] All discovered containers included
- [ ] Technologies match discovery stack
- [ ] Database type matches `stack.backend.database`
- [ ] @startuml in kebab-case: `@startuml 02-containers`
- [ ] Protocols specified in all relationships
