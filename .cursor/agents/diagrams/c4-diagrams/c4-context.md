# C4 Context Diagram (Level 1)

## Purpose

Shows the system in its environment with users and external systems. This is the highest-level view of the C4 model.

## Prerequisites

**Required Input from Discovery:**

```yaml
# From c4-discovery.md Phase 6: Diagram Strategy
diagram_strategy:
  context:
    system_name: "{discovered_system_name}"
    system_description: "{from_readme_or_config}"
    users:
      - name: "{user_type_1}"
        description: "{user_description}"
      - name: "{user_type_2}"
        description: "{user_description}"
    external_systems:
      - name: "{external_service_1}"
        type: "{service_type}"
      - name: "{external_service_2}"
        type: "{service_type}"
```

---

## Generation Process

### Step 1: Extract from Discovery Summary

Use these discovered values:

| Placeholder | Discovery Source |
|-------------|------------------|
| `{system_name}` | `diagram_strategy.context.system_name` |
| `{system_description}` | `diagram_strategy.context.system_description` |
| `{users[]}` | `diagram_strategy.context.users` |
| `{external_systems[]}` | `diagram_strategy.context.external_systems` |
| `{version}` | From package.json, pom.xml, or config |

### Step 2: Map Elements

#### Users to Person Elements

For each user in `diagram_strategy.context.users`:

```plantuml
Person({user_id}, "{user_name}", "{user_description}")
```

#### External Systems to System_Ext Elements

For each external in `diagram_strategy.context.external_systems`:

```plantuml
System_Ext({external_id}, "{external_name}", "{external_description}")
```

### Step 3: Generate Relationships

Based on discovered infrastructure:

| External Service Type | Relationship |
|-----------------------|--------------|
| Email Service | `Rel(system, email, "Sends notifications", "SMTP/API")` |
| File Storage | `Rel(system, storage, "Stores files", "S3 API/File System")` |
| Payment Gateway | `Rel(system, payment, "Processes payments", "HTTPS/API")` |
| Database (external) | `Rel(system, db, "Stores data", "SQL/NoSQL")` |

---

## Elements Reference

### Person (Users)

```plantuml
Person(id, "Name", "Description")
```

### System (Main System)

```plantuml
System(id, "Name", "Description")
```

### System_Ext (External Systems)

```plantuml
System_Ext(id, "Name", "Description")
```

### Relationships

```plantuml
Rel(source, target, "Label", "Technology")
Rel(source, target, "Label")  ' Without technology
```

**Important:** DO NOT use empty string: `Rel(a, b, "Uses", "")` is incorrect.

---

## PlantUML Template

```plantuml
@startuml 01-context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

' Generated by C4 Diagram Generator on {YYYY-MM-DD}
' Agent: C4 Diagram Generator
' System: {system_name} v{version}

title {system_name} - Context Diagram

' Users (from discovery.diagram_strategy.context.users)
' GENERATE ONE Person() FOR EACH DISCOVERED USER
Person({user_1_id}, "{user_1_name}", "{user_1_description}")
Person({user_2_id}, "{user_2_name}", "{user_2_description}")

' Main System (from discovery.diagram_strategy.context.system_name)
System({system_id}, "{system_name}", "{system_description}")

' External Systems (from discovery.diagram_strategy.context.external_systems)
' GENERATE ONE System_Ext() FOR EACH DISCOVERED EXTERNAL SYSTEM
System_Ext({ext_1_id}, "{ext_1_name}", "{ext_1_description}")
System_Ext({ext_2_id}, "{ext_2_name}", "{ext_2_description}")

' Relationships
' GENERATE Rel() BASED ON DISCOVERED INTERACTIONS
Rel({user_1_id}, {system_id}, "Uses", "HTTPS")
Rel({system_id}, {ext_1_id}, "{action}", "{protocol}")

@enduml
```

---

## Output File

`docs/diagrams/c4/01-context.puml`

---

## Validation

Delegate to `@c4-validation.md`:

- [ ] All discovered users appear as Person()
- [ ] All discovered external systems appear as System_Ext()
- [ ] @startuml in kebab-case: `@startuml 01-context`
- [ ] Metadata includes system name from discovery
- [ ] Rel() without empty strings
